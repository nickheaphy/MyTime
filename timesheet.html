<!DOCTYPE html>
<html>
  <head>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css' rel='stylesheet'>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css' rel='stylesheet'>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar/index.global.min.js'></script>
    <script>

      document.addEventListener('DOMContentLoaded', function() {
        const calendarEl = document.getElementById('calendar')
        const calendar = new FullCalendar.Calendar(calendarEl, {
            firstDay: 1,
            initialView: 'timeGridWeek',
            slotDuration: '00:15',
            slotLabelInterval: '01:00',
            themeSystem: 'bootstrap5',
            selectable: true,
            unselectAuto: false,
            selectMirror: true,
            select: function(arg) {
                // User has created a date range.
                // Need to add to the events and to the database
                // https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dialog
                // https://stackoverflow.com/questions/41570878/jquery-dialog-popup-returns-json-to-new-page-instead-of-current-page

                // this needs to be a proper model dialog with the
                // data that I want to store
                var title = prompt('Event Title:');
                if (title) {
                    var thenewevent = calendar.addEvent({
                        title: title,
                        start: arg.start,
                        end: arg.end,
                        allDay: arg.allDay,
                        backgroundColor: 'red'
                    })
                    // this is where it needs to ajax the backend DB to store
                    console.log("Save to database Ajax")
                    const xhttp = new XMLHttpRequest();
                    xhttp.open("POST", "/saveEventDatatoDB", true);
                    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                    xhttp.send("start="+arg.start+"&end="+arg.end);
                }
                calendar.unselect()
            },
            eventClick: function(arg) {
                // User has clicked on an existing item. Need to offer ability to
                // edit or remove.
                // Need to add/remove from the database
                if (confirm('Are you sure you want to delete this event?')) {
                    arg.event.remove()
                }
            },
            datesSet: function(arg) {
                console.log(arg.start + " to " + arg.end)
                // this should load the data from the database for the period
                const xhttp = new XMLHttpRequest();
                xhttp.open("GET", "/getEventDatafromDB?start="+arg.start+"&end="+arg.end, true);
                xhttp.send("test");
            },
            editable: true,
            // need to load the calendar events from the database into an events array here
            // to match the physical timesheet, should also have some events with display: background
            // to have the gray boxes on the timesheet.
            events: [
                {
                    start: '2024-01-18T00:00:00',
                    end: '2024-01-18T08:30:00',
                    backgroundColor: '#C9C9C9',
                    display: 'background'
                },
                {
                    start: '2024-01-18T12:00:00',
                    end: '2024-01-18T13:00:00',
                    backgroundColor: '#C9C9C9',
                    display: 'background'
                },
                {
                    start: '2024-01-18T17:00:00',
                    end: '2024-01-18T23:59:59',
                    backgroundColor: '#C9C9C9',
                    display: 'background'
                },
            ] 
        })

        

        calendar.render()
      })

    </script>
  </head>
  <body>
    <div id='calendar'></div>
  </body>
</html>